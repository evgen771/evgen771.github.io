---
layout: post
title: rsync. Копирование файлов, которых отсутствуют в папке назначения.
categories: Программы
---

Для копирования **только отсутствующих в папке назначения файлов** с помощью `rsync` используется опция `--ignore‑existing`.


#### Базовый синтаксис

```bash
rsync [опции] источник/ назначение/
```

**Важно:** 

- Слэш `/` в конце пути к источнику означает «копировать содержимое директории». 
- Без слэша копируется сама директория вместе с содержимым.

#### Пример команды

```bash
rsync -av --ignore-existing /путь/к/источнику/ /путь/к/назначению/
```

#### Разбор опций

- `-a` (**archive**) - режим архива: рекурсивно копирует файлы, сохраняет: 
- права доступа, 
- временные метки, 
- символические ссылки, 
- владельцев и группы. 
- `-v` (**verbose**) - поробный вывод (показывает, какие файлы копируются).  
- `--ignore-existing` - **не перезаписывать файлы, которые уже есть в папке назначения** (даже если они отличаются по содержимому или дате).

#### Как это работает

1. `rsync` сканирует источник и назначение. 
2. Для каждого файла в источнике: 
- если файл **отсутствует** в назначении - копируется; 
- если файл **уже есть** в назначении - пропускается (не трогается).
3. Файлы, которые есть в назначении, но отсутствуют в источнике, **не удаляются** (в отличие от опции `--delete`).

#### Дополнительные полезные опции

- `-n` (`--dry-run`) - **пробный прогон**: показывает, какие файлы будут скопированы, но не выполняет копирование. **Всегда используйте перед реальными операциями!** 

  ```bash
  rsync -avn --ignore-existing /источник/ /назначение/
  ```
  
- `-h` (`--human-readable`) - выводит размеры файлов в удобном формате (KB, MB). 
- `-z` (`--compress`) - сжимает данные при передаче (полезно для сетевых операций). 
- `--progress` - показывает прогресс копирования каждого файла.

#### Пример с проверкой

1. Пробный прогон: 

   ```bash
   rsync -avnh --ignore-existing /home/user/docs/ /backup/docs/
   ```
2. Реальное копирование (после проверки): 

   ```bash
   rsync -avh --ignore-existing /home/user/docs/ /backup/docs/
   ```

#### Важные замечания

- **Безопасность**: всегда проверяйте пути к источнику и назначению перед запуском.  
- **Права доступа**: если копируете между системами, убедитесь, что у вас есть права на запись в папку назначения. 
- **Символические ссылки**: по умолчанию сохраняются как ссылки (не копируется их содержимое). Для изменения поведения используйте опции `-l` или `-L`.
