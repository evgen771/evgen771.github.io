---
layout: post
title: SSH. Передача данных между FreeBSD(сервер) и Linux(клиент)
categories: Программы
---

Для безопасной передачи данных между FreeBSD (сервер) и Linux (клиент) по SSH используйте **scp** (Secure Copy) или **sftp** (SSH File Transfer Protocol). 

Оба метода шифруют данные.


#### 1. Передача файлов через `scp`

#### Основные команды

**С клиента (Alt Linux) на сервер (FreeBSD):** 

```bash
scp /путь/к/файлу username@server_ip:/целевой/путь
```
Пример: 

```bash
scp ~/документы/report.pdf user@192.168.1.100:/home/user/
```

**С сервера (FreeBSD) на клиент (Alt Linux):** 

```bash
scp username@server_ip:/путь/к/файлу /локальный/путь
```
Пример: 

```bash
scp user@192.168.1.100:/home/user/logs.txt ~/загрузки/
```

#### Дополнительные опции

- **Рекурсивное копирование директорий** (`-r`): 

  ```bash
  scp -r ~/папка user@192.168.1.100:/home/user/
  ```

- **Указание порта** (если SSH работает не на 22): 

  ```bash
  scp -P 2222 файл user@192.168.1.100:/путь
  ```

- **Повышение скорости** (сжатие данных, `-C`): 

  ```bash
  scp -C большой_файл user@192.168.1.100:/путь
  ```

- **Вывод прогресса** (`-v` для отладки): 

  ```bash
  scp -v файл user@192.168.1.100:/путь
  ```

#### 2. Передача файлов через `sftp` (интерактивный режим)

Подходит для сложных операций (переименование, удаление, просмотр директорий).

**Подключение:** 

```bash
sftp username@server_ip
```
Пример: 

```bash
sftp user@192.168.1.100
```

**Основные команды в `sftp`:**

- `ls` - список файлов на сервере.
- `lls` - список файлов на клиенте.
- `cd /путь` - смена директории на сервере.
- `lcd /путь` - смена директории на клиенте.
- `get файл`- скачать файл с сервера.
- `put файл` - загрузить файл на сервер.
- `rm файл` - удалить файл на сервере.
- `mkdir папка` - создать директорию на сервере.
- `quit` — выход.

**Пример сессии:** 

```bash
sftp> put ~/документы/отчет.docx
sftp> get /home/user/backup.zip
sftp> quit
```

#### 3. Передача данных через SSH‑туннель (для других протоколов)

Если нужно передать данные по незащищённому протоколу (например, HTTP), используйте **SSH‑туннелирование**:

**Локальный порт‑форвардинг:** 

```bash
ssh -L локальный_порт:целевой_хост:порт username@server_ip
```
Пример (доступ к веб‑интерфейсу на сервере через `localhost:8080`):

```bash
ssh -L 8080:localhost:80 user@192.168.1.100
```
Теперь откройте в браузере `http://localhost:8080`.

#### 4. Рекомендации по безопасности

1. **Используйте ключи SSH вместо паролей** (см. раздел «Аутентификация по ключам» в предыдущем ответе).
2. **Меняйте стандартный порт SSH** (например, на `2222`) для снижения риска атак.
3. **Ограничьте доступ** в `/etc/ssh/sshd_config`:  
   ```
   AllowUsers user1 user2
   PasswordAuthentication no  # если используются ключи
   ```
4. **Следите за правами файлов**: 

   - На сервере: 
   
     ```bash
     chmod 600 ~/.ssh/authorized_keys
     chmod 700 ~/.ssh
     ```

#### 5. Проверка передачи

- Убедитесь, что файлы скопированы корректно (сравните размеры, проверьте содержимое).
- Если возникают ошибки, используйте `scp -v` для детального лога.
- Для больших файлов можно использовать `rsync` через SSH: 

  ```bash
  rsync -avz -e "ssh -p 2222" файл user@192.168.1.100:/путь
  ```

#### Итог

- **`scp`** — просто и быстро для единичных файлов.
- **`sftp`** — удобно для интерактивного управления файлами.
- **SSH‑туннель** — для защиты других протоколов.
- Всегда используйте **ключи SSH** и **надёжные пароли** для максимальной безопасности.
