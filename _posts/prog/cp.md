---
layout: post
title: Команда cp
categories: Программы
---

Команда **`cp`** в Linux - это основной инструмент для **копирования файлов и директорий** в терминале. 

Она входит в состав GNU Coreutils и доступна практически в любой Unix-подобной системе:

- Linux, macOS, BSD и других.

#### Назначение команды `cp`

Команда `cp` создаёт **точную копию** одного или нескольких файлов или каталогов в указанном месте. Исходный файл при этом **не изменяется** — он остаётся на месте, а копия помещается в целевую директорию.

#### Базовый синтаксис

```sh
cp [опции] <источник> <назначение>
```

- **`источник`** - путь к файлу или каталогу, который нужно скопировать.
- **`назначение`** - путь к месту, куда нужно поместить копию.

---

#### Примеры использования

1. **Копирование файла в текущую директорию:**

   ```sh
   cp file.txt backup.txt
   ```
   
   Создаёт копию `file.txt` с именем `backup.txt`

2. **Копирование файла в другую директорию:**

   ```sh
   cp document.pdf /home/user/Documents/
   ```
   
   Копирует `document.pdf` в папку `Documents`
   
3. **Копирование нескольких файлов в директорию:**

   ```sh
   cp file1.txt file2.txt file3.txt /backup/
   ```
   
   Все три файла будут скопированы в каталог `/backup/`

4. **Копирование директории (рекурсивно):**

   ```sh
   cp -r my_folder/ backup_folder/
   ```
   
   Опция `-r` (или `-R`) необходима, чтобы копировать каталоги со всем содержимым, включая подпапки.



#### Основные опции команды `cp`

```sh
| Опция | Название | Описание |
|------|---------|--------|
| `-r`, `-R` | `--recursive` | Копирует каталоги и всё их содержимое (включая подкаталоги). **Обязательна для папок.** |
| `-i` | `--interactive` | Перед перезаписью существующего файла спрашивает подтверждение (`y/n`). |
| `-f` | `--force` | Принудительно перезаписывает файлы без запроса. |
| `-u` | `--update` | Копирует только если исходный файл **новее**, чем существующий в целевой директории. Полезно для бэкапов. |
| `-v` | `--verbose` | Показывает подробный вывод: какие файлы копируются. |
| `-a` | `--archive` | Архивный режим: копирует с сохранением всех атрибутов — прав доступа, владельца, временных меток, символических ссылок. Идеально для резервного копирования. |
| `-p` | `--preserve` | Сохраняет права доступа, временные метки и владельца. |
| `-l` | `--link` | Создаёт жёсткие ссылки вместо копирования (экономит место на диске). |
| `-n` | `--no-clobber` | Не перезаписывает существующие файлы. |
| `--help` | — | Показывает справку по команде. |
| `--version` | — | Выводит версию утилиты `cp`. |
```

#### Примеры с опциями

1. **Безопасное копирование с подтверждением:**

   ```sh
   cp -i config.conf /etc/
   ```
   
*Если файл уже существует — система спросит: перезаписать или нет.*

2. **Копирование с сохранением всех атрибутов (для бэкапов):**

   ```sh
   cp -a /home/user/data/ /backup/data/
   ```
   
*Подходит для создания «зеркальных» копий.*
   

3. **Обновляющее копирование (только новые файлы):**

   ```sh
   cp -u *.log /archive/logs/
   ```
   
*Полезно в скриптах для инкрементного бэкапа.*

4. **Копирование с подробным выводом:**

   ```sh
   cp -v file.txt /tmp/
   ```
   
Выведет: `‘file.txt’ -> ‘/tmp/file.txt’`.

5. **Рекурсивное копирование папки:**

   ```bash
   cp -r project/ project_backup/
   ```
   
*Создаст полную копию проекта.*



#### Важные нюансы

- Если вы забудете `-r` при копировании папки, система выдаст ошибку: `omitting directory`

- `cp` **не копирует символические ссылки по умолчанию** - копируется сам файл, на который они указывают. Чтобы скопировать саму ссылку, используйте `-d` или `-a`

- При копировании между разными файловыми системами (например, с SSD на HDD) данные **физически копируются**. Внутри одной файловой системы - процесс может быть оптимизирован (например, при поддержке `CoW - Copy-on-Write`, как в `Btrfs` или `ZFS`)

- Команда `cp` **не удаляет исходные файлы** в отличие от `mv`


#### Советы и лайфхаки

- Используйте `cp -i` по умолчанию: добавьте в `~/.bashrc` строку:

  ```sh
  alias cp='cp -i'
  ```
  Это защитит от случайной перезаписи.

- Для больших каталогов лучше использовать `rsync`:

  ```bash
  rsync -av source/ destination/
  ```
*Он поддерживает докачку, прогресс и синхронизацию.*

- Копирование по сети: используйте `scp`:

  ```sh
  scp file.txt user@remote:/path/
  ```

- Копирование структуры папок без файлов:

  ```sh
  find . -type d -exec mkdir -p /backup/{} \;
  ```

#### Ошибки новичков

```sh
| Ошибка | Последствия | Как избежать |
|-------|------------|-------------|
| `cp folder/ /backup/` без `-r` | Ошибка: `omitting directory` | Всегда используйте `-r` для папок |
| `cp * /backup/` в папке с тысячами файлов | Переполнение командной строки | Используйте `find` или `rsync` |
| `cp -r /home/user /backup/` без проверки | Огромная копия, может заполнить диск | Проверяйте объём данных заранее |
| `cp file.txt /root/` без прав | Ошибка доступа | Используйте `sudo`, если нужно |
```

#### Заключение

Команда `cp` простая, но мощная. 

Понимание её опций помогает:

- безопасно управлять файлами,
- делать бэкапы,
- автоматизировать задачи в скриптах,
- избегать потерь данных.

**Совет:** перед массовым копированием всегда проверяйте пути и используйте `-i` или `-u` для безопасности.

