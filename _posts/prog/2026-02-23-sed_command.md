---
layout: post
title: sed.  Потоковый редактор текста.
categories: Программы
---


#### Что такое `sed`

`sed` (Stream Editor) — потоковый редактор текста в Unix‑подобных системах. Он обрабатывает текст построчно: читает строку, применяет команды, выводит результат. По умолчанию не изменяет исходный файл.

#### Базовый синтаксис

```bash
sed [опции] 'команды' [файл(ы)]
```

#### Важные опции

* `-n` — не выводить строки по умолчанию (используется с `p`, `w`).
* `-i` — редактировать файл «на месте» (с резервной копией: `-i.bak`).
* `-E` или `-r` — включить расширенные регулярные выражения.
* `-e` — указать несколько команд.
* `-f` — прочитать команды из файла.

#### Основные команды `sed`

---
- `s` — замена

`s/шаблон/замена/флаги`

заменить все `cat` на `dog` в файле `animals.txt`:
   
```bash
sed 's/cat/dog/g' animals.txt

```
`g` — глобальная замена (все вхождения в строке)

---

- `d` — удаление строк

Удалить 3‑ю строку:
   
```bash
sed '3d' file.txt
```
Удалить строки с `error`:

```bash
sed '/error/d' log.txt
```
---

- `p` — печать строк

вывести строки с `success`:

```bash
sed -n '/success/p' log.txt
```
---

- `a` — добавить строку после указанной

добавить `allow all` после строк с `server`:

```bash
sed '/server/a\allow all' nginx.conf
```
---

- `i` — вставить строку перед указанной
вставить комментарий перед 5‑й строкой:

`sed '5i\# Новая настройка' config.txt`

---

- `c` — заменить всю строку

заменить 3‑ю строку на комментарий:

`sed '3c\# Эта строка заменена' config.txt`

---

- `y` — посимвольная замена

заменить `abc` на `ABC`:

`sed 'y/abc/ABC/' letters.txt`

---

- `=` — вывести номер строки

показать общее количество строк:
   
`sed -n '$=' file.txt`

---

- `q` — выход после выполнения

вывести первые 10 строк и остановиться:

`sed '10q' log.txt`

---

- `w` — записать строки в файл

сохранить строки с `ERROR` в отдельный файл:
    
`sed -n '/ERROR/w errors.txt' auth.log`

---

#### Удалить пробел (без предпросмотра)

`sed -i 's/ //g' 1.txt`

#### Удаление любых пробельных символов в начале строки:

`sed 's/^\s*//' исходный_файл.txt > новый_файл.txt`
`sed 's/^\s*//' исходный_файл.txt`

`\s` соответствует любому пробельном символу (пробел, табуляция, неразрывный пробел и т. д.).

`^` — начало строки

#### Команда для удаления пробелов в конце строки:

`sed 's/ *$//' файл.txt`

Разбор синтаксиса:

```bash
    s/ — команда замены;
    * — ноль или более пробелов;
    $ — конец строки;
    // — замена на пустоту (удаление);
```
#### замена двух пробелов на один

`sed 's/  / /g' файл.txt`

```
    s/ — команда замены;
    два пробела подряд () — шаблон поиска;
    один пробел ( ) — замена;
    g — флаг «глобально»: заменяет все вхождения двойного пробела в строке.
```

#### Замена двух пробелов на один с использованием регулярного выражения

```
sed -E 's/ {2}/ /g' файл.txt
```
```
-E — включает расширенные регулярные выражения;
{2} — ровно два повторения предыдущего символа (пробела).
```

#### Удалить все пробелы, заменить тире: 

`sed -i 's/ //g; s/—/_/g' файл`

#### С резервной копией: 

`sed -i.bak 's/ //; s/—/_/g' файл` 

#### Тестирование (без изменения):

`sed 's/ //; s/—/_/g' файл`

#### Заменить пробел на дефис или наоборот

`sed -i 's/ /-/g' 1.txt`

#### Что делает:

```
    s/ — команда замены;
    / / — ищем пробел;
    - — заменяем на дефис;
    g — заменяем все вхождения в строке.
```

#### Если нужно убрать запятые, но сохранить строки, используйте замену:

s`ed -i 's/,//g' 1.txt`

`s/,//g` — заменяет запятую на пустоту (удаляет запятую);

строка остаётся, запятая исчезает. 

#### Заменить длинный дефис на нижнее подчеркивание

`sed -i 's/—/_/g' 1.txt`

Чтобы заменить дефис `(-) (—)` на нижнее подчёркивание `(_)`, используйте команду:
bash

`sed -i 's/-/\\_/g' файл.txt`   # иногда нужно экранирование

#### Разбор синтаксиса:

```
    s — команда замены (substitute);
    - — шаблон поиска (дефис);
    _ — символ замены (нижнее подчёркивание);
    g — флаг «глобально»: заменяет все вхождения в строке;
    -i — редактирование «на месте» (изменяет исходный файл);
```

*экранирующий обратный слеш (\) перед _ не обязателен, но не помешает*.
    
## Как скомпоновать команды для **удаления пробелов** и **замены длинного тире (em‑dash) на нижнее подчёркивание**

#### Основной вариант: цепочка команд в одном вызове `sed`


```bash
sed -i 's/ //; s/—/_/g' файл.txt
```

**Разбор:**

* `-i` — редактирование «на месте»;
* `s/ //` — удаляет **первый пробел** в строке (без флага `g` действует только на первое вхождение);
* `;` — разделитель команд;
* `s/—/_/g` — заменяет **все длинные тире** (`—`) на `_`;
* `g` — флаг «глобально»: заменяет все вхождения в строке.

**Пример:**

Исходный файл:

```
apple — fruit
banana — yellow
```

Результат:

```
apple_fruit
banana_yellow
```

## Другие варианты компоновки

#### Удалить **все** пробелы, заменить длинное тире

Если нужно убрать **все пробелы** (а не только первый):

```bash
sed -i 's/ //g; s/—/_/g' файл.txt
```

* `s/ //g` — удаляет все пробелы в строке.

#### Использовать другой разделитель (чтобы избежать путаницы)

Если в шаблонах или заменах есть слеши, смените разделитель на `|` или `@`:

```bash
sed -i 's| ||; s|—|_|g' файл.txt    # удалить первый пробел
sed -i 's| |||g; s|—|_|g' файл.txt  # удалить все пробелы
```

#### С резервной копией файла

Добавьте `.bak` после `-i`, чтобы создать резервную копию:

```bash
sed -i.bak 's/ //; s/—/_/g' файл.txt
```

Создаст:

* `файл.txt.bak` — оригинал;
* `файл.txt` — изменённый файл.

#### Тестирование без изменения файла

Перед `-i` проверьте результат на экране:

```bash
sed 's/ //; s/—/_/g' файл.txt
```

Вывод покажет, как изменится файл, но сам файл останется нетронутым.

#### Обработка только определённых строк

Заменить в строках, содержащих определённый текст (например, `word`):
```bash
sed '/word/s/ //; /word/s/—/_/g' файл.txt
```
Или короче (в одной команде):

```bash
sed '/word/{s/ //; s/—/_/g;}' файл.txt
```

#### Использование Unicode‑кода длинного тире

Для надёжности укажите длинное тире через его байтовое представление в UTF‑8 (`\xE2\x80\x94`):

```bash
sed -i 's/ //; s/\xE2\x80\x94/_/g' файл.txt
```
Способ полезен, если редактор некорректно отображает длинное тире.

---

## Пошаговая инструкция

#### Проверьте содержимое файла:**

   ```bash
   cat файл.txt
   ```
#### Протестируйте цепочку команд на экране:**

   ```bash
   sed 's/ //; s/—/_/g' файл.txt
   ```
#### Если результат верный, примените `-i`:**

   * Без бэкапа: `sed -i 's/ //; s/—/_/g' файл.txt`
   * С бэкапом: `sed -i.bak 's/ //; s/—/_/g' файл.txt`
   
#### Убедитесь, что замена прошла:**

   ```bash
   cat файл.txt
   ```

---

#### Сравнение вариантов

| Задача | Команда |
|------|-------|
| Удалить первый пробел, заменить длинное тире на `_` | `sed -i 's/ //; s/—/_/g' файл` |
| Удалить все пробелы, заменить тире | `sed -i 's/ //g; s/—/_/g' файл` |
| С другим разделителем | `sed -i 's| ||; s|—|_|g' файл` |
| С резервной копией | `sed -i.bak 's/ //; s/—/_/g' файл` |
| Тестирование (без изменения) | `sed 's/ //; s/—/_/g' файл` |
| Через Unicode‑код | `sed -i 's/ //; s/\xE2\x80\x94/_/g' файл` |

---

####  Важные замечания

* **Порядок команд.** В цепочке `sed` выполняет команды **последовательно**, слева направо. Убедитесь, что порядок соответствует задаче.
* **Экранирование.** Пробел и длинное тире не требуют экранирования в `sed`, если указаны напрямую.
* **Флаги.** Без `g` команда действует только на **первое вхождение** в строке; с `g` — на **все**.
* **Кодировка.** Убедитесь, что файл в UTF‑8 (проверьте через `file файл.txt`). Для длинных тире это критично.
* **Права доступа.** Если возникает ошибка «Операция не позволена», используйте `sudo` или смените права через `chmod`.

