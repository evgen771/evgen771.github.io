---
layout: post
title: rsync. Копирование, передать несколько каталогов.
categories: Программы
---

Разберу подробно, как передать несколько каталогов с помощью `rsync`.

#### Основные способы

**Способ 1. Перечисление каталогов в команде**

Просто укажите пути к нужным каталогам после источника:

```bash
rsync -av /path/to/dir1/ /path/to/dir2/ /path/to/dir3/ user@remote:/destination/
```

**Способ 2. Использование файла со списком каталогов**

1. Создайте файл со списком путей (например, `filelist.txt`):
```
/path/to/dir1/
/path/to/dir2/
/path/to/dir3/
```
2. Запустите `rsync` с опцией `--files-from`:
```bash
rsync -av --files-from=filelist.txt / user@remote:/destination/
```
Здесь `/` — базовый путь. Все пути в файле будут интерпретироваться относительно него.

**Способ 3. Использование шаблонов (wildcards)**

Если каталоги имеют общую часть в названии:
```bash
rsync -av /path/to/dir*/ user@remote:/destination/
```
Или для всех каталогов в текущей директории:
```bash
rsync -av */ user@remote:/destination/
```

---

#### Важные опции `rsync`

Рекомендуемые базовые опции:
* `-a` (`--archive`) — архивный режим (рекурсивно копирует, сохраняет права, владельца, временные метки и т. д.);
* `-v` (`--verbose`) — подробный вывод (показывает процесс копирования);
* `-z` — сжатие данных при передаче (полезно для медленных соединений);
* `--progress` — отображение прогресса копирования для каждого файла;
* `--delete` — удаляет файлы в целевом каталоге, если их нет в исходном (синхронизация);
* `-P` — комбинация `--partial` и `--progress` (сохраняет частично переданные файлы и показывает прогресс).

Пример команды с расширенным набором опций:
```bash
rsync -avzP /dir1/ /dir2/ user@remote:/backup/
```

---

#### Практические примеры

**Пример 1. Локальное копирование**

Копирование двух каталогов в другое место на том же компьютере:
```bash
rsync -av /home/user/docs/ /home/user/photos/ /backup/
```

**Пример 2. Копирование на удалённый сервер**

Передача нескольких каталогов на сервер через SSH:
```bash
rsync -avz user@server:/var/www/html/ /var/www/logs/ /local/backup/
```
или наоборот:
```bash
rsync -avz /local/dir1/ /local/dir2/ user@server:/remote/backup/
```

**Пример 3. С использованием файла списка**

1. Создаём файл `dirs_to_sync.txt`:
```
Documents/
Pictures/
Music/
```
2. Выполняем синхронизацию (предполагается, что файлы находятся в домашней директории):
```bash
rsync -av --files-from=dirs_to_sync.txt ~/ user@backup-server:/home/backup/
```

**Пример 4. С шаблонами**

Копируем все каталоги, начинающиеся с `project_`:
```bash
rsync -av ~/projects/project_*/ user@server:/backup/projects/
```

---

#### Тонкости и нюансы

1. **Косая черта (`/`) в конце пути**
   * Если поставить `/` в конце исходного пути (`/source/`), `rsync` скопирует *содержимое* каталога.
   * Без `/` (`/source`) будет скопирован *сам каталог* вместе с содержимым.

   Пример:
   ```bash
   # Скопирует содержимое dir1 в dest/
   rsync -av /dir1/ /dest/

   # Скопирует каталог dir1 целиком в dest/ (получится dest/dir1/)
   rsync -av /dir1 /dest/
   ```

2. **Относительные и абсолютные пути**
   При использовании `--files-from` удобно работать с относительными путями. Базовый путь задаётся после опции.

3. **Исключение файлов**
   Используйте `--exclude` для фильтрации:
   ```bash
   rsync -av --exclude='*.tmp' /dir1/ /dir2/ user@remote:/dest/
   ```

4. **Тестовый прогон**
   Перед реальной синхронизацией используйте `--dry-run`, чтобы увидеть, что будет сделано:
   ```bash
   rsync -av --dry-run /dir1/ /dir2/ user@remote:/dest/
   ```

---

#### Краткий итог

* Для 2–3 каталогов проще перечислить их в команде.
* Для большого числа каталогов или регулярного использования создайте файл со списком и используйте `--files-from`.
* Шаблоны (`*`) удобны, если каталоги можно выбрать по маске.
* Всегда тестируйте команду с `--dry-run` перед запуском.
* Используйте `-avz` как базовый набор опций для большинства задач.

