---
layout: post
title: tar в FreeBSD, с примерами.
categories: Программы
---

### tar в FreeBSD — полный гайд

#### Что такое tar?

`tar` = **T**ape **Ar**chiver

Сам по себе **НЕ сжимает**, а:

* собирает файлы в один архив (`.tar`)
* может работать вместе с компрессией (`gzip`, `bzip2`, `xz`, `zstd`)

В FreeBSD используется **BSD tar** (не GNU tar, есть отличия).

#### Общий синтаксис

```sh
tar [опции] [архив] [файлы/каталоги]
```

#### Основные режимы (самое важное)

| Ключ | Назначение               |
| ---- | ------------------------ |
| `-c` | создать архив            |
| `-x` | извлечь                  |
| `-t` | показать содержимое      |
| `-f` | имя архива (ОБЯЗАТЕЛЬНО) |
| `-v` | подробный вывод          |

>`-f` **должен быть последним перед именем архива**


### Создание архива (.tar)

#### Архивировать каталог

```sh
tar -cf backup.tar /home/user
```

#### Архивировать несколько файлов

```sh
tar -cf files.tar file1.txt file2.txt
```

#### С подробным выводом

```sh
tar -cvf backup.tar /etc
```

#### Просмотр содержимого архива

```sh
tar -tf backup.tar
```

#### С подробностями:

```sh
tar -tvf backup.tar
```

### Извлечение архива

#### Извлечь в текущий каталог

```sh
tar -xf backup.tar
```

#### С выводом файлов

```sh
tar -xvf backup.tar
```

#### Извлечь в другой каталог

```sh
tar -xvf backup.tar -C /tmp/restore
```

### Сжатие (очень важно)

#### gzip (.tar.gz / .tgz)

```sh
tar -czvf backup.tar.gz /home
```

#### Распаковка:

```sh
tar -xzvf backup.tar.gz
```

#### bzip2 (.tar.bz2)

```sh
tar -cjvf backup.tar.bz2 /home
```

#### Распаковка:

```sh
tar -xjvf backup.tar.bz2
```

#### xz (.tar.xz)

```sh
tar -cJvf backup.tar.xz /home
```

#### Распаковка:

```sh
tar -xJvf backup.tar.xz
```


#### zstd (современно, быстро)

```sh
tar --zstd -cvf backup.tar.zst /home
```

Распаковка:

```sh
tar --zstd -xvf backup.tar.zst
```

#### Извлечь один файл из архива

```sh
tar -xvf backup.tar etc/rc.conf
```

### Исключение файлов и каталогов

#### Исключить каталог

```sh
tar -cvf backup.tar /home --exclude=/home/user/.cache
```

#### Несколько исключений

```sh
tar -cvf backup.tar /home \
  --exclude=.cache \
  --exclude=Downloads
```

### Архивирование без абсолютных путей (ОЧЕНЬ ВАЖНО)

Неправильно:

```sh
tar -cvf etc.tar /etc
```

Правильно:

```sh
cd /
tar -cvf etc.tar etc
```

или

```sh
tar -cvf etc.tar -C / etc
```

### Сохранение прав, владельцев, симлинков

```sh
tar -cvpf backup.tar /usr/local
```

| Ключ              | Значение         |
| ----------------- | ---------------- |
| `-p`              | сохранить права  |
| `--numeric-owner` | UID/GID без имён |


### Архивирование системы (FreeBSD)

#### Исключая виртуальные ФС

```sh
tar -cvpf system.tar \
  --exclude=/dev \
  --exclude=/proc \
  --exclude=/tmp \
  --exclude=/mnt \
  /
```

#### Проверка архива

```sh
tar -tf backup.tar > /dev/null
```

Если ошибок нет — архив целый.


### Архивирование через pipe (продвинуто)

#### tar + gzip вручную

```sh
tar -cvf - /home | gzip > backup.tar.gz
```

Распаковка:

```sh
gzip -dc backup.tar.gz | tar -xvf -
```

### Инкрементальное архивирование

```sh
tar -cvf backup.tar --newer=2025-01-01 /home
```

Архивируются только новые файлы.

### Частые ошибки

#### Забыли `-f`

```sh
tar -cv backup.tar /home
```

#### Перепутали порядок

```sh
tar -cvf /home backup.tar   # НЕПРАВИЛЬНО
```

### Быстрая шпаргалка

| Задача     | Команда                         |
| ---------- | ------------------------------- |
| Создать    | `tar -cvf a.tar dir`            |
| Посмотреть | `tar -tvf a.tar`                |
| Извлечь    | `tar -xvf a.tar`                |
| gzip       | `tar -czvf a.tar.gz dir`        |
| bzip2      | `tar -cjvf a.tar.bz2 dir`       |
| xz         | `tar -cJvf a.tar.xz dir`        |
| zstd       | `tar --zstd -cvf a.tar.zst dir` |


