---
layout: post
title: Программа grep. Рекурсивный поиск. FreeBSD.
categories: Программы
---


#### Основной инструмент: рекурсивный поиск

Для поиска в каталогах используется опция `-r` (`--recursive`). Она заставляет `grep` обходить все подкаталоги рекурсивно.

Базовый синтаксис:

```bash
grep -r "шаблон" /путь/к/каталогу/
```

**Пример:** поиск строки «error» во всех файлах каталога `/var/log` и его подкаталогах:

```bash
grep -r "error" /var/log/
```

#### Ключевые опции для поиска в каталогах

- **`grep -r`** — рекурсивный поиск (базовый вариант).
- **`grep -rl`** — вывести только имена файлов, содержащих совпадения (полезно для составления списка файлов).
- **`grep -ri`** — рекурсивный поиск без учёта регистра.
- **`grep -rn`** — рекурсивный поиск с выводом номеров строк.
- **`grep -rw`** — поиск целых слов (не подстрок) во всех файлах каталога.

#### Базовый рекурсивный поиск

Найти все файлы в каталоге `/home/user/projects`, содержащие строку «TODO»:

```bash
grep -r "TODO" /home/user/projects/
```
Вывод будет содержать путь к файлу и строку с совпадением:

```
/home/user/projects/app.py:    # TODO: Add error handling
/home/user/projects/config.ini:; TODO: Update version
```

#### Только имена файлов

Вывести только имена файлов с совпадениями (без самих строк):

```bash
grep -rl "TODO" /home/user/projects/
```
Результат:
```
/home/user/projects/app.py
/home/user/projects/config.ini
```

#### Поиск без учёта регистра

Найти «error», «Error», «ERROR» и т. д. в логах:

```bash
grep -ri "error" /var/log/
```

#### Номера строк

Показать номера строк с совпадениями:

```bash
grep -rn "warning" /var/log/app/
```
Пример вывода:
```
/var/log/app/debug.log:45:warning: Low disk space
/var/log/app/error.log:102:warning: Timeout occurred
```

#### Поиск целых слов

Найти только слово «config», но не «reconfig» или «configurable»:

```bash
grep -rw "config" /etc/
```

#### Фильтрация по типу файлов

Используйте опции `--include` и `--exclude` для ограничения поиска:

* **Поиск только в `.txt` файлах:**
  ```bash
  grep -r --include="*.txt" "pattern" /path/to/dir/
  ```
* **Исключение `.log` файлов:**
  ```bash
  grep -r --exclude="*.log" "pattern" /path/to/dir/
  ```
* **Несколько масок включения:**
  ```bash
  grep -r --include="*.php" --include="*.html" "function" /var/www/
  ```

**Пример:** найти «database» только в конфигурационных файлах (`*.conf`, `*.ini`):
```bash
grep -r --include="*.conf" --include="*.ini" "database" /etc/
```

#### Контекст вокруг совпадений

Вывести 2 строки до и после совпадения:

```bash
grep -r -C2 "critical" /var/log/ --include="*.log"
```

#### Ограничение количества совпадений

Остановить поиск после первых 5 совпадений в каждом файле:

```bash
grep -r -m5 "debug" /home/user/src/
```

#### Инвертированный поиск

Найти файлы, **не** содержащие строку «success»:
```bash
grep -rL "success" /var/log/app/ --include="*.log"
```
(опция `-L` выводит имена файлов без совпадений).

#### Пропуск двоичных файлов

Автоматически пропускать бинарные файлы:

```bash
grep -rI "text" /usr/share/doc/
```
(опция `-I` полезна при поиске в системных каталогах).

#### Цветная подсветка

Подсветить совпадения цветом (удобно для визуального анализа):

```bash
grep -r --color=always "error" /var/log/ 2>/dev/null
```
`2>/dev/null` подавляет сообщения об ошибках доступа (например, к `/proc/`).

#### Поиск нескольких шаблонов

Найти файлы с «error» или «warning»:
```bash
grep -r -E "error|warning" /var/log/ --include="*.log"
```
Или через несколько опций `-e`:
```bash
grep -r -e "error" -e "warning" /var/log/
```

#### Нюансы и советы

- **Права доступа.** Если в каталоге есть файлы с ограниченным доступом, используйте `sudo`:

   ```bash
   sudo grep -r "root" /etc/
   ```
- **Текущий каталог.** Для поиска в текущей директории используйте `.`:

   ```bash
   grep -r "pattern" .
   ```
- **Производительность.** Для фиксированных строк (без регулярных выражений) добавляйте `-F`:

   ```bash
   grep -rF "exact_string" /path/to/dir/
   ```
- **Экранирование спецсимволов.** Если шаблон содержит метасимволы (`*`, `.`, `[`), экранируйте их или используйте `-F`.
- **Маски в `--include/--exclude`.** Всегда заключайте маски в кавычки, чтобы оболочка не расширяла их.
- **Подавление ошибок.** Добавьте `-s`, чтобы скрыть сообщения об ошибках (например, «Permission denied»):

   ```bash
   grep -rs "pattern" /var/
   ```

---

#### Краткий справочник опций для каталогов

| Опция | Назначение |
|-------|----------|
| `-r`, `--recursive` | Рекурсивный поиск во всех подкаталогах |
| `-l`, `--files-with-match` | Вывести только имена файлов с совпадениями |
| `-L`, `--files-without-match` | Вывести имена файлов без совпадений |
| `--include=PATTERN` | Искать только в файлах, соответствующих маске |
| `--exclude=PATTERN` | Исключить файлы, соответствующие маске |
| `-I` | Пропускать двоичные файлы |
| `-s` | Подавить сообщения об ошибках |


