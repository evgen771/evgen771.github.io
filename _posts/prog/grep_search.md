#### Что такое `grep`

`grep` (расшифровывается как *global regular expression print*) — утилита для поиска строк, соответствующих заданному шаблону (строке или регулярному выражению), в текстовых файлах или выводе других команд. Предустановлена почти во всех дистрибутивах Linux/Unix.

#### Базовый синтаксис

```bash
grep [опции] шаблон [файлы]
```

Где:

- **опции** — дополнительные параметры поиска и вывода;
- **шаблон** — строка или регулярное выражение для поиска;
- **файлы** — один или несколько файлов для поиска (можно использовать маски, например `*.txt`).

Если файлы не указаны, `grep` читает данные из стандартного ввода (например, вывод другой команды через пайп `|`).

#### Основные опции

| Опция | Описание |
|-------|---------|
| `-i`, `--ignore-case` | Игнорировать регистр при поиске |
| `-v`, `--invert-match` | Вывести строки, **не** содержащие шаблон (инвертированный поиск) |
| `-w`, `--word-regexp` | Искать только целые слова (не части слов) |
| `-c` | Вывести количество найденных строк |
| `-l`, `--files-with-match` | Вывести только имена файлов с совпадениями |
| `-L`, `--files-without-match` | Вывести имена файлов **без** совпадений |
| `-n` | Показать номера строк с совпадениями |
| `-o`, `--only-matching` | Выводить только совпавшую часть строки, а не всю строку |
| `-m N` | Остановить поиск после нахождения N совпадений |
| `--color=always` | Подсветить совпадения цветом |
| `-A N` | Вывести N строк **после** совпадения |
| `-B N` | Вывести N строк **до** совпадения |
| `-C N` | Вывести N строк до и после совпадения (контекст) |
| `-r`, `--recursive` | Рекурсивный поиск в директории и её поддиректориях |
| `-I` | Пропускать двоичные файлы |
| `-s` | Подавить сообщения об ошибках (например, при отсутствии прав доступа) |
| `-f файл` | Читать шаблоны поиска из файла (по одному на строку) |
| `-E`, `--extended-regexp` | Использовать расширенные регулярные выражения (ERE) |
| `-F`, `--fixed-strings` | Искать фиксированные строки (не регулярные выражения) |

#### Простой поиск в файле

Найти все строки с «error» в файле `log.txt`:
```bash
grep "error" log.txt
```

#### Поиск без учёта регистра

Найти «error», «Error», «ERROR» и т. д.:
```bash
grep -i "error" log.txt
```

#### Поиск целых слов

Найти только слово «root», но не «rooted» или «unroot»:
```bash
grep -w "root" /etc/passwd
```

#### Инвертированный поиск

Вывести все строки, **не** содержащие «nologin»:
```bash
grep -v "nologin" /etc/passwd
```

#### Подсчёт совпадений

Узнать, сколько раз встречается «warning» в логе:
```bash
grep -c "warning" app.log
```

#### Вывод номеров строк

Показать строки с «timeout» и их номера:
```bash
grep -n "timeout" config.ini
```

#### Рекурсивный поиск

Найти все файлы в `/var/log/`, содержащие «Kernel»:
```bash
grep -r "Kernel" /var/log/
```

С фильтрацией по расширению (только `.log`):
```bash
grep -r --include="*.log" "Kernel" /var/log/
```

Исключить файлы `.journal`:
```bash
grep -r --exclude="*.journal" "Kernel" /var/log/
```

#### Вывод контекста

Показать строку с «Error» и 3 строки после неё:
```bash
grep -A3 "Error" /var/log/dmesg
```

Показать 2 строки до и после совпадения:
```bash
grep -C2 "critical" system.log
```

#### Поиск нескольких шаблонов

Через опцию `-e` (каждый шаблон отдельно):
```bash
grep -e "root" -e "daemon" /etc/passwd
```

Через расширенные регулярные выражения (`-E`):
```bash
grep -E "root|daemon|bin" /etc/passwd
```

#### Чтение шаблонов из файла

Создать файл `patterns.txt` со строками:
```
error
warning
critical
```

Затем искать все эти строки в логе:
```bash
grep -f patterns.txt app.log
```

#### Фильтрация вывода команд

Найти процессы с «httpd» или «apache»:
```bash
ps aux | grep -E "httpd|apache"
```

Отфильтровать только IP‑адреса из вывода `ifconfig`:
```bash
ifconfig | grep -o '[0-9]\+\.[0-9]\+\.[0-9]\+\.[0-9]\+'
```

#### Цветной вывод

Подсветить совпадения (полезно при просмотре больших файлов):
```bash
grep --color=always "pattern" huge_file.txt
```

#### Поиск строк по началу/концу

Строки, начинающиеся с «#» (комментарии):
```bash
grep "^#" script.sh
```

Строки, заканчивающиеся на «.conf»:
```bash
grep ".conf$" /etc/hosts
```

---

#### Важные нюансы

- **Регулярные выражения**:

   *По умолчанию `grep` использует *basic regular expressions* (BRE)*.
   
   *Для расширенных выражений (ERE) используйте `-E`*.
   
   *Экранируйте спецсимволы (`\.`, `\*`, `\?`), если хотите искать их буквально*.

- **Маски файлов**:
   *При рекурсивном поиске (`-r`) маски (`--include`, `--exclude`) указываются в кавычках*.

- **Права доступа**:

   *Если файл недоступен для чтения, `grep` выдаст ошибку. Используйте `-s`, чтобы её подавить*.

- **Двоичные файлы**:

   *По умолчанию `grep` пытается искать и в бинарных файлах. Опция `-I` пропускает их автоматически*.

- **Производительность**:

   *Для поиска фиксированных строк (без регулярных выражений) используйте `-F` — это быстрее*.

- **Переменные в скриптах**:

   *Передавайте переменные в `grep` в двойных кавычках*:
     ```bash
     pattern="my_string"
     grep "$pattern" file.txt
     ```

---

#### Краткий справочник по регулярным выражениям

- `.` — любой символ;
- `*` — ноль или более повторений предыдущего символа;
- `^` — начало строки;
- `$` — конец строки;
- `[abc]` — любой из символов в скобках;
- `[^abc]` — любой символ, кроме указанных;
- `\<` — начало слова;
- `\>` — конец слова.

