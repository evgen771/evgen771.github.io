---
layout: post
title: doas vs sudo
categories: /feed/blog
---

На **FreeBSD** утилита **doas** — это рекомендуемый способ выполнения команд с правами суперпользователя, особенно в свежих установках, где `sudo` не установлен по умолчанию.

**doas** это лёгкая и безопасная альтернатива, изначально разработанная для OpenBSD.

#### Установка doas на FreeBSD

Может потребоваться установка пакета, если он отсутствует:

```sh
pkg install doas
```

#### Настройка doas на FreeBSD

Файл конфигурации находится по пути:
 
`/usr/local/etc/doas.conf`

>Файл **не создаётся автоматически**, его нужно создать вручную.

#### Пример базовой конфигурации:

Разрешить пользователям из группы wheel выполнять команды от имени root

```sh
permit persist :wheel as root
```

Если вы хотите, чтобы **конкретный пользователь** (например, `alice`) мог использовать `doas` без пароля:

```sh
permit nopass alice as root
```

Или разрешить только определённые команды:

```sh
permit alice as root cmd /usr/sbin/service
```

#### Права доступа к конфигурации

Установите правильные права на файл:

```sh
sudo chown root:wheel /usr/local/etc/doas.conf
sudo chmod 0400 /usr/local/etc/doas.conf
```

Проверьте синтаксис:

```sh
doas -C /usr/local/etc/doas.conf && echo "Конфигурация корректна" || echo "Ошибка в конфигурации"
```

#### Добавление пользователя в группу wheel

Если ваш пользователь ещё не в группе `wheel`, добавьте его:

```sh
pw groupmod wheel -m имя_пользователя
```

Замените `имя_пользователя` на ваше имя (например, `alice`).

После этого перезайдите в систему, чтобы изменения вступили в силу.

#### Примеры использования

- Обновить систему:

  ```sh
  doas freebsd-update fetch install
  ```

- Установить пакет:

  ```sh
  doas pkg install vim
  ```

- Перезапустить службу:

  ```sh
  doas service sshd restart
  ```

- Запустить root-оболочку:

  ```sh
  doas -s
  ```

#### Установка sudo на FreeBSD

Утилита sudo позволяет избавиться от необходимости работать в оболочке (Shell) от имени суперпользователя (su)

`sudo` также можно установить:

```sh
pkg install sudo
```

А затем настроить через `visudo` и добавить пользователя в группу `wheel` или `sudo`

#### Для этого используем следующую команду:

После установки sudo необходимо подредактировать конфигурационный файл с помощью специальной утилиты `visudo` (устанавливается вместе с пакетом sudo), в файле требуется раскомментировать или добавить строку вида:

`# visudo`
`% wheel ALL=(ALL:ALL) ALL`

или

Редактируем sudo:

`# ee /usr/local/etc/`
`% wheel ALL=(ALL:ALL) ALL`

После чего сохранить изменения и выйти из visudo.

Если Вы используете редактор vi, что наиболее вероятно, то требуется нажать следующую последовательность клавиш:

`ESC -> :wq -> ENTER`

Если Вы используете редактор ee то:

`Esc -> a -> a`

Наличие данной строки в конфигурационном файле утилиты `sudo` позволит получать привилегии суперпользователя всем пользователям которые входят в группу `wheel`.

Напомню, что я внес себя в группу wheel при инсталляции.

#### Редактируем sudo чтобы программа не требовала пароль и запускалась из меню.

Открываем файл `sudoers`

Он находится в:

`# ee /usr/local/etc/`

Добавляем в конец файла строку:
 
`user ALL=(ALL:ALL) NOPASSWD: /usr/local/bin/name_prog`

**Совет**:

Если ты только начинаешь работать с FreeBSD — начни с `doas`.

Он проще, безопаснее и отлично справляется с повседневными задачами.

А если вдруг столкнёшься с программой, которая ждёт `sudo` — просто создай алиас:

```sh
echo 'alias sudo="doas"' >> ~/.cshrc     # для csh/tcsh (по умолчанию в FreeBSD)
```

Или, если используешь `bash`/`zsh`:

```bash
echo 'alias sudo="doas"' >> ~/.bashrc
```

Теперь все команды с `sudo` будут работать через `doas`

#### Почему doas — хороший выбор для FreeBSD?

- **Минимализм**: меньше кода — меньше уязвимостей.
- **Простота**: конфигурация понятна даже новичку.
- **Безопасность**: отсутствие лишних функций снижает риск ошибок.
- **Официальная поддержка**: активно используется в экосистеме FreeBSD.


