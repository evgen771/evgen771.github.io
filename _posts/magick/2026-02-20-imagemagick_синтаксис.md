---
layout: post
title: "ImageMagick. Базовый синтаксис. Основное."
categories: Magick
---

Базовый синтаксис команд **ImageMagick** зависит от используемой утилиты. В современных версиях (начиная с 7.0) **рекомендуется использовать команду `magick`** — она объединяет функционал устаревших утилит (`convert`, `mogrify` и др.).


#### Основной синтаксис

```bash
magick [options] input_file output_file
```

**Где:**

- `[options]` — набор параметров и операций (фильтров, преобразований и т. п.);
- `input_file` — путь к исходному файлу (поддерживается множество форматов: JPEG, PNG, GIF, TIFF, PDF и др.);
- `output_file` — путь и имя выходного файла (формат определяется по расширению).


---

#### Ключевые утилиты (устаревшие, но всё ещё используемые)

1. **`convert`**  
   Создаёт новое изображение на основе исходного (не затрагивает оригинал).  
   **Синтаксис:** 

   ```bash
   convert [options] input_file output_file
   ```

2. **`mogrify`**  
   Изменяет исходный файл *напрямую* (перезаписывает его!).  
   **Синтаксис:** 

   ```bash
   mogrify [options] input_file
   ```
   *Важно:* всегда делайте резервные копии перед использованием `mogrify`.

3. **`identify`**  
   Выводит информацию о файле (формат, размеры, глубину цвета и т. д.).  
   **Синтаксис:** 

   ```bash
   identify [options] input_file
   ```

---

### Основные опции и примеры

#### 1. Изменение размера

```bash
magick input.jpg -resize 800x600 output.jpg
```

- `800x600` — новые ширина и высота (сохранение пропорций);
- Чтобы *не увеличивать* маленькие изображения, добавьте `>`:  
  ```
  magick input.jpg -resize 800x800> output.jpg
  ```

#### 2. Обрезка

```bash
magick input.jpg -crop 400x300+50+50 output.jpg
```

- `400x300` — размер обрезанной области;
- `+50+50` — смещение верхнего левого угла (X, Y).

#### 3. Поворот

```bash
magick input.jpg -rotate 90 output.jpg
```

- `90` — угол поворота (градусы, по часовой стрелке);
- Для поворота против часовой стрелки используйте отрицательное значение: `-90`.

#### 4. Изменение качества (для JPEG)

```bash
magick input.jpg -quality 80 output.jpg
```

- `80` — качество в процентах (1–100).

#### 5. Удаление метаданных

```bash
magick input.jpg -strip output.jpg
```

- `-strip` удаляет EXIF, IPTC и другие служебные данные.

#### 6. Конвертация формата

```bash
magick input.png output.jpg
```
- Формат выходного файла определяется по расширению.

#### 7. Наложение текста

```bash
magick input.jpg -pointsize 20 -fill white -annotate +50+50 "Текст" output.jpg
```

- `-pointsize 20` — размер шрифта;
- `-fill white` — цвет текста;
- `+50+50` — координаты (X, Y) для размещения текста.

#### 8. Применение фильтров

```bash
magick input.jpg -blur 0x8 output.jpg
```

- `-blur 0x8` — размытие (радиус и сигма).

#### #9. Создание GIF-анимации

```bash
magick -delay 100 -loop 0 frame1.jpg frame2.jpg animation.gif
```

- `-delay 100` — задержка между кадрами (в сотых долях секунды);
- `-loop 0` — бесконечное повторение.


#### 10. Объединение изображений (коллаж)

```bash
magick input1.jpg input2.jpg +append result.jpg
```

- `+append` — горизонтальное объединение;
- `-append` — вертикальное объединение.

---

#### Полезные советы

1. **Проверка версии:**  

   ```bash
   magick -version
   ```

2. **Список поддерживаемых форматов:**  

   ```bash
   magick identify -list format
   ```

3. **Подробная информация о файле:**  

   ```bash
   magick identify -verbose input.jpg
   ```

4. **Работа с несколькими файлами (массовая обработка):** 

   ```bash
   magick *.jpg -resize 50% resized_%03d.jpg
   ```

   - `%03d` — нумерация выходных файлов (001, 002 и т. д.).

5. **Использование конвейеров (pipe):**  

   ```bash
   magick input.jpg -resize 100x100 png:- | magick - flip.jpg
   ```
   
   - `png:-` выводит результат в формате PNG в стандартный вывод.

---

#### Важные замечания

- **Безопасность:** `mogrify` перезаписывает исходные файлы. Используйте с осторожностью!
- **Совместимость:** В старых скриптах может встречаться `convert`. В новых версиях лучше использовать `magick`.
- **Документация:** Для детального изучения опций смотрите `man magick` или официальный сайт ImageMagick.
