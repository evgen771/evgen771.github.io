---
layout: post
title: ImageMagick. Основные опции ImageMagick для сжатия и ресайза
categories: Magick
---

#### JPG. Основные опции ImageMagick для сжатия и ресайза

Важно понимать, что нет «лучших» настроек. 

Применение одинаковых настроек ко всем изображениям, не даст лучших результатов. 

Некоторые изображения будут выглядеть размытыми, или наоборот, слишком резкими. 

Поэтому нужно выбрать «средние» параметры, которые вам подойдут.

Примеры использования параметра `-quality`:

```bash
convert img.jpg -quality 80 img1.jpg
```

#### Примеры использования параметра `-thumbnail`

Ресайз по ширине `100px`, с сохранением соотношения сторон (высота изменится пропорционально):

```bash
convert img.jpg -thumbnail 100x img1.jpg
```

Ресайз по высоте `150px`, с сохранением соотношения сторон (ширина изменится пропорционально):

```bash
convert img.jpg -thumbnail x150 img1.jpg
```

Ресайз без сохранения соотношения сторон:

```bash
convert img.jpg -thumbnail 100x150! img1.jpg
```

Ресайз в `%` (процентах):

```bash
convert img.jpg -thumbnail 20% img1.jpg 
```

#### Настроки, фильтры

- `-quality 80` — уровень сжатия (80 приблизительно равен 60 в Adobe Photoshop)
- `-strip `— удаление всех метаданных (exif, цветовой профиль и т.п.).
- `-resize` — изменяет размер изображения в пикселях.
- `-thumbnail` — опция похожая на `-resize`. Помимо реcайза, удаляет также и метаданные изображения. Говорят, что работает быстрее и качественнее, чем  `-resize`
- `-filter Lanczos` — фильтр Ланцоша.
- `-gaussian-blur 0.05` — размытие по Гауссу.
- `-sampling-factor 4:2:0` — цветовая субдискретизация.

```
Значение 4:2:0 уменьшает разрешение канала цветности до половины. Применяется только если параметр `-quality` меньше чем 90. 

Параметр `-sampling-factor` определяет коэффициенты выборки, которые будут использоваться кодером JPEG, для понижающей дискретизации цветности. Если этот параметр опущен, библиотека JPEG будет использовать собственные значения по умолчанию. 

Рекомендуется использовать его вместе с параметром `-define jpeg:dct-method=float`, что дает небольшое улучшение качества, без увеличения размера файла, поскольку использует более точное дискретное косинус-преобразование с плавающей запятой.
```
- `-unsharp 0x3+1+0` — придает ощущение большей четкости изображения.

```
Значения: `Радиус×Сигма+` `усиление+порог`
Радиус — радиус гауссова размытия в пикселях, не считая центральный пиксель (по умолчанию 0). Для приемлемых результатов радиус должен быть больше сигмы. 

Если он не задан или установлен на ноль, ImageMagick рассчитает максимально возможный радиус, который даст приемлемые результаты для распределения Гаусса.

Сигма — стандартное отклонение гауссова размытия в пикселях (по умолчанию 1.0). Является важным аргументом и определяет фактическое количество размытия, которое будет иметь место.

Усиление — величина разницы между оригинальным и размытым изображением, которое добавляется обратно в оригинал (по умолчанию 1.0).
Порог — величина количественной разницы между изображениями (по умолчанию 0,05).
```

- `-colorspace RGB` — цветовое пространство `RGB`.
- `-interlace Plane` — используется если нужен прогрессивный `JPEG`.



